<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>读取网络上文件到内存</title>
    
    <meta name="author" content="mahang">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/twitter/stylesheets/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css" type="text/css" rel="stylesheet" media="all">


    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="/">树莓派的奇幻漂流</a>
            <ul class="nav">
                
                


  <li><a href="/archive">Archive</a></li>


                
                


  <li><a href="/tags">Tags</a></li>


                
                


  <li><a href="/categories">Categories</a></li>


                
                


  <li><a href="/pages">Pages</a></li>


                
                


  <li><a href="/about">About Me</a></li>


                
            </ul>
        </div>
    </div>
</div>

<div class="container">

    <div class="content">
        
<div class="page-header">
  <h1>Blogs</h1>
</div>


<div class="row">
  <div class="span12">

    <div class="pagination">
      <ul>
      
        
        
          <li><a href="/posts/1/">1</a></li>
        
      
        
          <li class="active"><a href="/posts/2/">2</a></li>
        
        
      
      </ul>
    </div>


    
      <div class="post">
        <h1 class="title"><a href="/go/idea-intellij-go-%22can%E2%80%99t-find-import%22-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">idea intellij go &#34;can’t find import&#34; 解决方法</a> <span class="date">2013-07-04</span></h1>

        <p>尝试重多golang的ide，最后发现intellij目前做的完成度最高</p>

<p>eclipse go 不能进行包、类、方法等的跳转，这点是无法忍受的，所以果断换成intellij</p>

<p>但是发现在intellij里面不能import <code>$GOPATH</code>里src下的包，网上搜索了很长时间，
在这里找到解决方法：<a href="https://github.com/mtoader/google-go-lang-idea-plugin/issues/224">https://github.com/mtoader/google-go-lang-idea-plugin/issues/224</a></p>

<blockquote>
<pre><code>Looking through the source, it seems that the plugin doesn't use the $GOPATH (to be fair, I think earlier Go docs didn't make the distinction between using $GOPATH and $GOROOT quite as clear as they do now).
In setting up the plugin you have to 
1.) create symlinks for all of the imported package directories in your $GOPATH:
    a. $GOROOT/src/pkg/ -&gt; $GOPATH/src
    ex. from within $GOROOT/src/pkg, ln -s $GOPATH/src/github.com
    b. $GOROOT/pkg/target/ -&gt; $GOPATH/pkg/target/
    ex. from within $GOROOT/pkg/darwin_amd64, ln -s $GOPATH/pkg/darwin_amd64/code.google.com
2.) you MUST set up a source directory when creating the project (however, it can be an empty string, which will then cause the wizard to prompt you that it will set the project root as the source directory)
</code></pre>
</blockquote>

<p>附上一片比较完整搭建go环境的博文：
<a href="http://icfly.cn/archives/2013/05/golang-ide.html">http://icfly.cn/archives/2013/05/golang-ide.html</a></p>


        <div class="more">
          <a href="/go/idea-intellij-go-%22can%E2%80%99t-find-import%22-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="btn btn-small">阅读全文</a>
        </div>
      </div>
    
      <div class="post">
        <h1 class="title"><a href="/raspberry/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%8A%98%E8%85%BE%E6%89%8B%E8%AE%B0/">树莓派折腾手记</a> <span class="date">2013-05-22</span></h1>

        <h2>OS X下通过下面的命令能够把镜像写入SD</h2>

<pre><code>unzip 2013-02-09-wheezy-raspbian.zip
df -h
sudo diskutil unmount /dev/rdisk1s1
sudo dd bs=1m if=2013-02-09-wheezy-raspbian.img of=/dev/rdisk1
sudo diskutil eject /dev/rdisk1
</code></pre>

<p>更换了一个更加快速的源</p>

<hr />

<p>pi的源列表: <a href="http://www.raspbian.org/RaspbianMirrors">http://www.raspbian.org/RaspbianMirrors</a> 测试了之后发现这个源在国内更新最快 <a href="http://mirror.devunt.kr/raspbian/raspbian/">http://mirror.devunt.kr/raspbian/raspbian/</a></p>

<p>更换源：
<code>sudo vi /etc/apt/sources.list</code>
更改为：</p>


        <div class="more">
          <a href="/raspberry/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%8A%98%E8%85%BE%E6%89%8B%E8%AE%B0/" class="btn btn-small">阅读全文</a>
        </div>
      </div>
    
      <div class="post">
        <h1 class="title"><a href="/vim/vim%E5%BF%AB%E6%8D%B7%E9%94%AE/">vim快捷键</a> <span class="date">2013-01-13</span></h1>

        <p><img src="/assets/media/vi_tutorial.png" width="95%" /></p>

<p><a href="/assets/media/vi_tutorial.png">原图</a></p>


        <div class="more">
          <a href="/vim/vim%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="btn btn-small">阅读全文</a>
        </div>
      </div>
    
      <div class="post">
        <h1 class="title"><a href="/2012/new-born.html">你的第一篇博客</a> <span class="date">2012-12-22</span></h1>

        <h1>感谢你使用Gor编写博客</h1>

<h2>本文位于 posts/first-blog.md , 你可以任何删掉,修改这个文件。</h2>

<p>文件开头是当前文章的元数据</p>

<ol>
<li>date为自动生成, 当然,你可以修改,这是你的自由</li>
<li>permalink 可以是固定地址,也可以由gor为你自动生成</li>
<li>categories 就是分类, 可以多个</li>
<li>tags 同理,多个标签也是很常见的</li>
</ol>

<p>请确保文件使用UTF8 without BOM编码</p>

<h2>你可以通过执行下面的语句来新建一篇博客:</h2>

<pre><code>gor post 文章标题
</code></pre>


        <div class="more">
          <a href="/2012/new-born.html" class="btn btn-small">阅读全文</a>
        </div>
      </div>
    
      <div class="post">
        <h1 class="title"><a href="/code/%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E4%B8%8A%E6%96%87%E4%BB%B6%E5%88%B0%E5%86%85%E5%AD%98/">读取网络上文件到内存</a> <span class="date">2011-12-19</span></h1>

        <p>从网络上下载文件到硬盘相对简单，拿到文件输出流，网络上的输入流，一边读输入流一边写输出流，都读取完毕，关掉输入、输出流就好。
但是读取网络上的文件到内存，由于不知道网络上文件的具体大小，没法申请一个准确的byte数组大小。而且读取网络上的输入流时，是不知道一次能读到的数据包的大小的，必须一点点的读取保存，又涉及byte数组的重新申请，和最后resize一个合适的byte[]，相对麻烦一些，把自己写的一小段代码记录在此，方便日后的使用。</p>

<pre><code>public byte[] readBytesFromUrl(String urlStr, int initLength) {
        if (initLength == 0) {
            return null;
        }
        try {
            URL url = new URL(urlStr);
            URLConnection conn = url.openConnection();
            InputStream inputStream = conn.getInputStream();
            byte[] buffer = new byte[initLength];
            byte[] temp = new byte[1024];
            int bytesum = 0;
            int byteread = 0;
            while ((byteread = inputStream.read(temp)) != -1) {
                for (int i = 0; i &lt; byteread; i++) {
                    int index = bytesum + i;
                    if (index == buffer.length) {
                        byte[] newBuffer = new byte[buffer.length + initLength];
                        for (int j = 0; j &lt; buffer.length; j++) {
                            newBuffer[j] = buffer[j];
                        }
                        buffer = newBuffer;
                    }
                    buffer[index] = temp[i];
                }
                bytesum += byteread;
            }
            if (buffer.length &gt; bytesum) {
                byte[] newBuffer = new byte[bytesum];
                for (int i = 0; i &lt; bytesum; i++) {
                    newBuffer[i] = buffer[i];
                }
                buffer = newBuffer;
            }
            return buffer;
        } catch (MalformedURLException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
</code></pre>


        <div class="more">
          <a href="/code/%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E4%B8%8A%E6%96%87%E4%BB%B6%E5%88%B0%E5%86%85%E5%AD%98/" class="btn btn-small">阅读全文</a>
        </div>
      </div>
    
      <div class="post">
        <h1 class="title"><a href="/code/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E8%8E%B7%E5%8F%96/">项目中资源文件的获取</a> <span class="date">2011-11-09</span></h1>

        <ul>
<li>通过类加载器获取</li>
</ul>

<pre><code>InputStream inputStream1 = this.getClass().getClassLoader()
                .getResourceAsStream(&quot;ExternalResource/data.xml&quot;);
</code></pre>

<ul>
<li>spring ApplicationContext获取</li>
</ul>

<pre><code>public class SpringApplicationContextHolder implements ApplicationContextAware {
    private static ApplicationContext context;

    @Override
    public void setApplicationContext(ApplicationContext context) throws BeansException {
        SpringApplicationContextHolder.context = context;
    }

    public static Object getSpringBean(String beanName) {
        notEmpty(beanName, &quot;bean name is required&quot;);
        return context.getBean(beanName);
    }

    public static File getResourceFile(String resource) throws IOException {
        return context.getResource(resource).getFile();
    }
}
</code></pre>


        <div class="more">
          <a href="/code/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E8%8E%B7%E5%8F%96/" class="btn btn-small">阅读全文</a>
        </div>
      </div>
    

    <div class="pagination">
      <ul>
      
        
        
          <li><a href="/posts/1/">1</a></li>
        
      
        
          <li class="active"><a href="/posts/2/">2</a></li>
        
        
      
      </ul>
    </div>
  </div>
</div>


    </div>

    <footer>
        <p>&copy; mahang 2013
            with help from <a href="http://github.com/wendal/gor" target="_blank" title="Gor -- Fast Blog">Gor</a>
            and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
            and Idea from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
	</p>
	<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cdiv align='center' id='cnzz_stat_icon_1000037964'%3E%3C/div%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000037964%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
    </footer>

</div> <!-- /container -->

<script src="/assets/twitter/javascripts/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>

<script>
    var _gaq=[['_setAccount','UA-123-12'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>
